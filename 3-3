#include <stdlib.h>
#include <stdio.h>
#include <string.h>

#define MAX_MONTHS 60

typedef struct
{
	char name[30];
	int salary[MAX_MONTHS];
} TPerson;

//returns month count from Jan 1980

int get_month(char *date)
{
	char *month, *year;
	int iMonth,iYear;

	month=strchr(date, '.');
	sscanf(month+1,"%d", &iMonth);

	year=strchr(month+1, '.');
	sscanf(year+1, "%d", &iYear);
	return (iYear-1980)*12+iMonth;
}

void main (void)
{
	FILE *F;
	char s[200];
	char name[30], date[20];
	int salary;
	char *semicolon1, *semicolon2;
	
	TPerson *persons = NULL;
	int personCount=0;
	int i;
	int personFound;
	int maxMonth=0, minMonth=99999;
	int month;
	
	F=fopen("salary.csv","rt");

	//get range
	
	while (!feof(F))
	{
		//read string from file
		fgets(s,200,F);
		

		semicolon1=strchr(s,';');

		semicolon2=strchr(semicolon1+1, ';');
		strncpy(date,semicolon1+1,semicolon2-semicolon1);
		date[semicolon2-semicolon1]=0;

		month = get_month(date);
		if (month>maxMonth)
			maxMonth=month;
		if (month<minMonth)
			minMonth=month;
	}

	fseek(F,0,SEEK_SET);
	
	//reading names and salaries
	while(!feof(F))
	{
		//read string from file
		fgets(s,200,F);
		
		semicolon1=strchr(s,';');
		strncpy(name,s,semicolon1-s);
		name[semicolon1-s]=0;

		semicolon2=strchr(semicolon1+1,';');
		strncpy(date,semicolon1+1,semicolon2-semicolon1);
		date[semicolon2-semicolon1]=0;

		sscanf(semicolon2+1,"%d",&salary);

		//search for person in array
		personFound=0;
		for (i=0;i<personCount;i++)
			if (strcmp(name,persons[i].name)==0)
			{
				persons[i].salary[get_month(date)-minMonth] += salary;
				personFound=1;
				break;
			}
	
	//if person not found
	if(!personFound)
	{
		//add person to array
		persons=(TPerson*)realloc(persons,(personCount+1)*sizeof(TPerson));
		memset(persons[personCount].salary,0,sizeof(persons[personCount].salary));
		persons[personCount].salary[get_month(date)-minMonth]=salary;
		strcpy(persons[personCount].name,name);
		personCount++;
		}
	printf("%s",s);
	}
	
	fclose(F);
	getchar();
	}

